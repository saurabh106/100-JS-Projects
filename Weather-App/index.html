<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="img/weather.svg" type="image/x-icon">
    <title>Weather App</title>
</head>
<body class="a">
    <video autoplay muted loop id="myVideo" class="vid" loading="lazy">
        <source type="video/mp4" class="src" loading="lazy">
    </video>
    
    <div class="click">
        <div class="voice1 btn1" id="volumex">
            <img src="img/volume-xmark-solid.svg" class="xmark">
            <img src="img/volume-high-solid.svg" class="volo">
        </div>
        <div class="voice2 btn1" id="videox">
            <img src="img/video-slash-solid.svg" class="slash">
            <img src="img/video-solid.svg" class="vide">
        </div>
    </div>
    
    <div class="wrapper">
        <h1>Weather App</h1>
        <div class="tab-container">
            <div class="your-weather tab">Your Weather</div>
            <div class="search-weather tab">Search Weather</div>
        </div>

        <div class="weather-container">
            <div class="grant-location">
                <img src="./img/location.webp" alt="location" width="80" height="80" loading="lazy">
                <p>Grant Location Access</p>
                <p>Allow Access To Get Weather Information</p>
                <button class="btn loc">Grant Access</button>
            </div>
            <div class="error">
                <img src="./img/error.png" width="80" height="80" loading="lazy">
                <p>ERROR 404</p>
                <p>Connection Error</p>
            </div>
            <div class="loading">
                <img src="./img/loading-gif-transparent-background-free-download-9.gif" alt="loading" height="120" width="120">
                <p>Loading</p>
            </div>
            <form id="search-tab">
                <input placeholder="Search For City..." input-field>
                <button class="btn" type="submit" btn-search>
                    <img src="img/magnifying-glass-solid.svg" alt="search" width="20" height="20" loading="lazy">
                </button>
            </form>
            <div class="user-info">
                <div class="name">
                    <p city-name></p>
                    <img country-icon>
                </div>
                <p weather-desc id="weather-desc"></p>
                <img weather-icon id="weather-icon">
                <p temp id="temp"></p>
                <div class="parameter-container">
                    <div class="parameter">
                        <img src="img/wind.png" alt="wind" height="50" width="50" title="If you need more information, click on it">
                        <p>WindSpeed</p>
                        <p windspeed></p>
                    </div>
                    <div class="parameter">
                        <img src="img/humidity.jpg" alt="humidity" height="50" width="50" title="If you need more information, click on it">
                        <p>Humidity</p>
                        <p humidity></p>
                    </div>
                    <div class="parameter">
                        <img src="img/cloud.png" alt="cloud" height="50" width="50" title="If you need more information, click on it">
                        <p>Cloud</p>
                        <p cloud></p>
                    </div>
                   
                </div>
                <!-- <div class="forecast-container">
                    <h2>5-Day Forecast</h2>
                    <div class="forecast"></div>
                </div>
                 -->
                <!-- <div class="four-day-forecast-container">
                    <h2>4-Day Forecast Details</h2>
                    <div class="four-day-forecast"></div>
                </div> -->
                <div class="clothes" title="What do you want to where according to your weather">
                    What do you want to where
                </div class="cloth">
                <div>
                <div class="clear">
                    <img class = "img1" src="Clothes/clear1.png" alt="">
                    <img class = "img1"src="Clothes/clear2.png" alt="">
                </div>
                <div class="clear">
                    <img class = "img1" src="Clothes/thunder1.png" alt="">
                    <img class = "img1"src="Clothes/thunder2.png" alt="">
                </div>
                <div class="clear">
                    <img class = "img1" src="Clothes/rain1.png" alt="">
                    <img class = "img1"src="Clothes/rain2.png" alt="">
                </div>
                <div class="clear">
                    <img class = "img1" src="Clothes/winter1.png" alt="">
                    <img class = "img1"src="Clothes/winter2.png" alt="">
                </div>
                <div class="clear">
                    <img class = "img1" src="Clothes/fog1.png" alt="">
                    <img class = "img1"src="Clothes/fog2.png" alt="">
                </div>
                <div class="clear">
                    <img class = "img1" src="Clothes/cloud1.png" alt="">
                    <img class = "img1"src="Clothes/cloud2.png" alt="">
                </div>
                </div>
            </div>
        </div>


    
    <script >

const yourtab = document.querySelector(".your-weather");
const searchtab = document.querySelector(".search-weather");
const grantUI = document.querySelector(".grant-location");
const grantbtn = document.querySelector(".loc");
const loadingUI = document.querySelector(".loading");
const input_field = document.querySelector("[input-field]");
const searchbtn = document.querySelector("[btn-search]");
const weatherUI = document.querySelector(".user-info");
const searchform = document.querySelector("#search-tab");
const vid = document.querySelector(".src");
const video = document.querySelector(".vid");
const volume = document.querySelector(".volo");
const novolume = document.querySelector(".xmark");
const videox = document.querySelector(".vide");
const novideo = document.querySelector(".slash");
novideo.classList.add("remove");
volume.classList.add("remove");
const videobtn = document.querySelector("#videox");
const volumebtn = document.querySelector(".voice1");
const prop = {};
const api = "60303b0f3ae8644b3632967cc2fb9480";
let currenttab = yourtab;
currenttab.classList.add("current-tab");
grantbtn.addEventListener('click', getlocation);
yourtab.addEventListener('click', () => { switchtab(yourtab); });
searchtab.addEventListener('click', () => { switchtab(searchtab); });
const msg = new SpeechSynthesisUtterance();
const err = document.querySelector(".error");

function getlocation() {
    stop();
    if (navigator.geolocation) {
        navigator.geolocation.watchPosition(usercoords);
    }
    else {
        alert('Location Permission Denied, Unable to detect Weather');
    }
}

function usercoords(position) {
    const coordinates = {
        lats: position.coords.latitude,
        long: position.coords.longitude,
    };
    sessionStorage.setItem('user-coords', JSON.stringify(coordinates));
    fetchuserweather(coordinates);
}

async function fetchuserweather(position) {
    const lat = position.lats;
    const lon = position.long;

    grantUI.classList.remove("active");
    weatherUI.classList.remove("active");
    loadingUI.classList.add("active");
    volume.classList.add("remove");
    novolume.classList.remove("remove");
    window.speechSynthesis.cancel(msg);
    try {

        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${api}&units=metric`);
        const data = await response.json();
        loadingUI.classList.remove("active");
        err.classList.remove("active");
        weatherUI.classList.add("active");
        volumebtn.classList.add("active");
        videobtn.classList.add("active");
        renderinfo(data);
        Object.assign(prop, data);
    }
    catch {
        loadingUI.classList.remove("active");
        err.classList.add("active");
    }
}


function renderinfo(stats) {
    const cityname = document.querySelector("[city-name]");
    const countryicon = document.querySelector("[country-icon]");
    const weatherdes = document.querySelector("[weather-desc]");
    const weathericon = document.querySelector("[weather-icon]");
    const temp = document.querySelector("[temp]");
    const windspeed = document.querySelector("[windspeed]");
    const humidity = document.querySelector("[humidity]");
    const cloud = document.querySelector("[cloud]");

    cityname.innerText = stats?.name;
    countryicon.src = `https://flagcdn.com/144x108/${stats?.sys?.country.toLowerCase()}.png`;
    weatherdes.innerText = stats?.weather[0]?.description;
    weathericon.src = `https://openweathermap.org/img/wn/${stats?.weather[0]?.icon}.png`;
    temp.innerText = `${stats?.main?.temp} Â°C`;
    windspeed.innerText = `${stats?.wind?.speed}m/s`;
    humidity.innerText = `${stats?.main?.humidity}%`;
    cloud.innerText = `${stats?.clouds?.all}%`;

    const main = stats?.weather[0]?.main;
    bgchange(main);

}
function switchtab(clickedtab) {
    if (clickedtab != currenttab) {
        currenttab.classList.remove("current-tab");
        currenttab = clickedtab;
        currenttab.classList.add("current-tab");
        video.classList.add("remove");
        stop();
    }
    if (!searchform.classList.contains("active")) {
        weatherUI.classList.remove("active");
        volumebtn.classList.remove("active");
        videobtn.classList.remove("active");
        grantUI.classList.remove("active");
        err.classList.remove("active");
        searchform.classList.add("active");
    }
    else {
        searchform.classList.remove("active");
        weatherUI.classList.remove("active");
        volumebtn.classList.remove("active");
        videobtn.classList.remove("active");
        err.classList.remove("active");
        getsessionstorage();
        video.classList.remove("remove");
    }
}

function getsessionstorage() {
    const localcord = sessionStorage.getItem('user-coords');
    if (localcord) {
        const coordinate = JSON.parse(localcord);
        fetchuserweather(coordinate);
    }
    else {
        grantUI.classList.add("active");
    }

}

searchform.addEventListener("submit", (e) => {
    e.preventDefault();
    if (input_field.value == "") return;
    else fetchsearchweather(input_field.value);
});

async function fetchsearchweather(loc) {
    loadingUI.classList.add("active");
    weatherUI.classList.remove("active");
    volumebtn.classList.remove("active");
    videobtn.classList.remove("active");
    grantUI.classList.remove("active");
    try {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${loc}&appid=${api}&units=metric`);
        const data = await response.json();
        loadingUI.classList.remove("active");
        weatherUI.classList.add("active");
        volumebtn.classList.add("active");
        videobtn.classList.add("active");
        renderinfo(data);
        Object.assign(prop, data);
    }
    catch {
        loadingUI.classList.remove("active");
        err.classList.add("active");
    }
}
getsessionstorage();

function bgchange(main) {
    video.classList.remove("remove");
    if (main == "Clear") {
        vid.src = "video/clear.mp4";
        video.load();
    }
    else if (main == "Thunderstorm") {
        vid.src = "video/light.mp4";
        video.load();
    }
    else if (main == "Drizzle" || main == "Rain") {
        vid.src = "video/rain.mp4";
        video.load();
    }
    else if (main == "Snow") {
        vid.src = "video/snow.mp4";
        video.load();
    }
    else if (main == "Mist" || main == "Smoke" || main == "Haze" || main == "Dust" || main == "Fog" || main == "Sand" || main == "Ash" || main == "Squall" || main == "Tornado") {
        vid.src = "video/fog.mp4";
        video.load();
    }
    else if (main == "Clouds") {
        vid.src = "video/clouds.mp4";
        video.load();
    }
}

videobtn.addEventListener('click', () => {
    switchvideobtn();
});

function switchvideobtn() {
    if (novideo.classList.contains("remove")) {
        novideo.classList.remove("remove");
        videox.classList.add("remove");
        video.classList.add("remove");
    }
    else {
        novideo.classList.add("remove");
        videox.classList.remove("remove");
        video.classList.remove("remove");
    }
}


volumebtn.addEventListener('click', () => {
    switchvolumebtn();
});
function switchvolumebtn() {
    if ('speechSynthesis' in window) {
        const voicestr = voice_assist();
        msg.text = voicestr.toString();
        const voices = window.speechSynthesis.getVoices();
        msg.voice = voices[0];
        if (volume.classList.contains("remove")) {
            volume.classList.remove("remove");
            novolume.classList.add("remove");
            window.speechSynthesis.speak(msg);
            alert("your browser support voive assistant ð");
        }
        else if (novolume.classList.contains("remove") || flag) {
            volume.classList.add("remove");
            novolume.classList.remove("remove");
            window.speechSynthesis.cancel(msg);
        }

    }
    else {
        alert("Sorry, your browser donot support voice assistant.");
    }
}
function voice_assist() {
    const denotionstr = gettimestr();
    const temp = `${prop?.main?.temp}`;
    const city = prop?.name;
    const name = "saurabh";
    const desc = prop?.weather[0]?.description;
    const windspeed = `${prop?.wind?.speed}`;
    const maxtemp = `${prop?.main?.temp_max}`;
    const mintemp = `${prop?.main?.temp_min}`;
    const humidity = `${prop?.main?.humidity}`;
    const cloud = `${prop?.clouds?.all}`;
    const d1 = prop?.sys?.sunrise;
    const dat1 = new Date(d1 * 1000);
    const hrsr = String(dat1.getHours());
    const minr = String(dat1.getMinutes());
    const secr = String(dat1.getSeconds());


    const d2 = prop?.sys?.sunset;
    const dat2 = new Date(d2 * 1000);
    const hrss = String(dat2.getHours());
    const mins = String(dat2.getMinutes());
    const secs = String(dat2.getSeconds());

    const voicestr = `${denotionstr}, ${city}! I'm ${name}, and it's time for your daily weather update.

    Right now, we have a ${desc} with a temperature of ${temp} degrees Celsius. The wind is coming in at ${windspeed} kilometers per hour.
    As we move through the day, temperatures will reach a high of ${maxtemp} degrees Celsius with a low of ${mintemp} degrees Celsius.

    Here are some additional details for your day:

    Humidity stands at ${humidity}.
    The clouds is ${cloud}.
    Sunrise is at ${hrsr}hours ${minr}minutes ${secr}seconds and sunset at ${hrss}hours ${mins}minutes ${secs}seconds.

    Stay tuned for further updates and have a fantastic day.
    `;

    return voicestr;


}

function gettimestr() {
    const d = new Date();
    const currhrs = d.getHours();
    if (currhrs < 12) {
        return "Good Morning"
    }
    else if (currhrs < 17) {
        return "Good Afternoon";
    }
    else {
        return "Good Evening";
    }
}

function stop() {
    volume.classList.add("remove");
    novolume.classList.remove("remove");
    window.speechSynthesis.cancel(msg);
}




const city = prop?.name;
const country = prop?.sys?.country;
const formattedLocation = encodeURIComponent(`${city}, ${country}`);

document.querySelector("img[alt='wind']").addEventListener('click', function() {
    window.open(`https://www.windy.com/en/search-locations?query=${formattedLocation}`, '_blank');
});

document.querySelector("img[alt='humidity']").addEventListener('click', function() {
    window.open(`https://www.windy.com/en/search-locations?query=${formattedLocation}`, '_blank');
});

document.querySelector("img[alt='cloud']").addEventListener('click', function() {
    window.open(`https://www.windy.com/en/search-locations?query=${formattedLocation}`, '_blank');
});


const api2 = "YOUR_API_KEY"; // Replace with your OpenWeatherMap API key

async function fetchForecast(lat, lon) {
    try {
        // Fetch 5-day forecast
        const forecastResponse = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${api}&units=metric`);
        const forecastData = await forecastResponse.json();
        renderForecast(forecastData);  // Call function to render forecast data
    } catch (error) {
        console.error("Error fetching forecast data:", error);
    }
}

function renderForecast(forecastData) {
    const forecastContainer = document.querySelector(".forecast");
    forecastContainer.innerHTML = "";  // Clear any existing forecast data

    // Loop through the forecast data to display the next 5 days
    const days = {};
    forecastData.list.forEach(item => {
        const date = new Date(item.dt * 1000).toDateString();
        if (!days[date]) {
            days[date] = [];
        }
        days[date].push(item);
    });

    const forecastEntries = Object.keys(days).slice(0, 5); // Get the first 5 days
    forecastEntries.forEach(date => {
        const dailyData = days[date][0]; // Use the first entry for each day
        const forecastDiv = document.createElement("div");
        forecastDiv.classList.add("forecast-item");
        
        const weatherDesc = dailyData.weather[0].description;
        const icon = dailyData.weather[0].icon;
        const temp = Math.round(dailyData.main.temp);
        
        forecastDiv.innerHTML = `
            <p>${date}</p>
            <img src="https://openweathermap.org/img/wn/${icon}.png" alt="${weatherDesc}" />
            <p>${temp} Â°C</p>
            <p>${weatherDesc}</p>
        `;
        forecastContainer.appendChild(forecastDiv);
    });
}

// Example usage: Call fetchForecast with latitude and longitude
// fetchForecast(latitude, longitude);


    </script>
</body>
</html>
